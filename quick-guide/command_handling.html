<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Command Handling - The Remark Tutorial</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="../quick-guide/index.html"><strong aria-hidden="true">1.</strong> Quick Guide</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../quick-guide/command_handling.html" class="active"><strong aria-hidden="true">1.1.</strong> Command Handling</a></li><li class="chapter-item expanded "><a href="../quick-guide/forms.html"><strong aria-hidden="true">1.2.</strong> Forms</a></li></ol></li><li class="chapter-item expanded "><a href="../in-depth/index.html"><strong aria-hidden="true">2.</strong> In Depth</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../in-depth/installing.html"><strong aria-hidden="true">2.1.</strong> Installing</a></li><li class="chapter-item expanded "><a href="../in-depth/commands.html"><strong aria-hidden="true">2.2.</strong> Commands</a></li><li class="chapter-item expanded "><a href="../in-depth/forms.html"><strong aria-hidden="true">2.3.</strong> Forms</a></li><li class="chapter-item expanded "><a href="../in-depth/command_args.html"><strong aria-hidden="true">2.4.</strong> Command Arg's</a></li><li class="chapter-item expanded "><a href="../in-depth/command_guards.html"><strong aria-hidden="true">2.5.</strong> Command Guard's</a></li><li class="chapter-item expanded "><a href="../in-depth/custom_form_elements.html"><strong aria-hidden="true">2.6.</strong> Custom Form Elements</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Remark Tutorial</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="command-handling"><a class="header" href="#command-handling">Command Handling</a></h1>
<p>Prerequisites:</p>
<ul>
<li>Basic knowledge of PHP</li>
</ul>
<h2 id="about-attributes"><a class="header" href="#about-attributes">About Attributes</a></h2>
<p>Skip to <a href="#your-first-command">Your First Command</a> if you already know PHP 8's attributes.</p>
<p>PHP 8 added attributes, markers that can be placed on classes or methods and later found by Remark through reflection.</p>
<pre><code class="language-php">#[Test(debug: false)]
public function myMethod(): void {}
</code></pre>
<p>PHP 8.1 attributes look a lot like comments. They start with <code>#[</code> and end with <code>]</code> and inside the brackets the name of attributes are placed. Attributes are really just classes, and inside you put parameters for their constructor. You have to make sure to import the attribute just like you would for a class.</p>
<p>You can have multiple attributes inside the same <code>#[]</code> structure.</p>
<pre><code class="language-php">#[Test(debug: false), Logging(level: 2)]
public function myMethod(): void {}
</code></pre>
<p>You can also omit the parameter names, to make the attributes more concise.</p>
<pre><code class="language-php">#[Test(false), Logging(2)]
public function myMethod(): void {}
</code></pre>
<h2 id="your-first-command"><a class="header" href="#your-first-command">Your First Command</a></h2>
<p>In Remark, you mark methods using attributes to describe how you want to take arguments from the command line.</p>
<pre><code class="language-php">use DiamondStrider1\Remark\Command\Cmd;
use DiamondStrider1\Remark\Command\CmdConfig;
use DiamondStrider1\Remark\Command\Arg\sender;
use DiamondStrider1\Remark\Command\Arg\text;
use DiamondStrider1\Remark\Command\Guard\permission;
use pocketmine\command\CommandSender;

#[CmdConfig(
    name: 'helloworld',
    description: 'Run my hello world command!',
    aliases: ['hw'],
    permission: 'plugin.helloworld.use'
)]
class MyCommand {
    #[Cmd('helloworld'), permission('plugin.helloworld.use')]
    #[sender(), text()]
    public function myFirstCommand(CommandSender $sender, string $text): void
    {
        $sender-&gt;sendMessage(&quot;§aHello Command Handling! - $text&quot;);
    }
}
</code></pre>
<p>This is a lot of code to tackle, but before going over it let's register our command so it can be used.</p>
<h2 id="registering-your-first-command"><a class="header" href="#registering-your-first-command">Registering Your First Command</a></h2>
<pre><code class="language-php">public function onEnable(): void
{
    Remark::command($this, new MyCommand());
    Remark::activate($this);
}
</code></pre>
<p><code>Remark::command()</code> adds one or more <code>BoundCommand</code>s that implement <code>PluginOwned</code>. <code>Remark::activate()</code> registers a listener that will add <code>TAB</code>-completion for players.</p>
<h2 id="the-breakdown"><a class="header" href="#the-breakdown">The Breakdown</a></h2>
<p>Let's go over everything in <code>MyCommand.php</code>.</p>
<h4 id="cmdconfig-attribute"><a class="header" href="#cmdconfig-attribute">CmdConfig Attribute</a></h4>
<pre><code class="language-php">#[CmdConfig( /* ... */ )]
</code></pre>
<p>CmdConfig customizes the underlying command that will ultimately be registered to PocketMine's CommandMap. Everything is pretty self-explanatory. <code>name</code> is the name of the command (i. e. <code>/command_name</code>).<code>permission</code> is set as the permission of the command, hiding the command from those who have insufficient permissions. <strong>IT DOES NOT</strong>, however, stop people from running the command by itself. We will get into that soon.</p>
<h4 id="cmd-and-permission"><a class="header" href="#cmd-and-permission">Cmd and permission</a></h4>
<pre><code class="language-php">#[Cmd('helloworld'), permission('plugin.helloworld.use')]
</code></pre>
<p>This line uses two attributes at once. The method these attributes are placed on are called a HandlerMethod. A method simply has to be marked by <code>Cmd</code> to become a HandlerMethod.</p>
<h4 id="cmd-attribute"><a class="header" href="#cmd-attribute">Cmd Attribute</a></h4>
<p>The <code>Cmd</code> is passed the name of the command. You can change the command to a subcommand by adding a comma followed by another string. For example, <code>#[Cmd('cmd', 'subcmd')]</code> would bind the method to the subcommand at <code>/cmd subcmd</code>. The command or subcommand chosen must be unique, meaning there is one HandlerMethod per command/subcommand.</p>
<h4 id="the-permission-guard"><a class="header" href="#the-permission-guard">The permission Guard</a></h4>
<p>The <code>permission</code> is something Remark calls a <code>Guard</code>. <code>Guard</code>s prevent unauthorized access to commands by ensuring that certain requirements are met. If the <code>permission</code> guard fails, it will send a generic not-enough-permissions error to the command sender. The HandlerMethod only runs if all <code>Guard</code>s attached to it succeed. Unlike the <code>permission</code> property of <code>CmdConfig</code>, this guard actually enforces that the command sender has permission to using the command. More permissions can be added by adding a comma and another string, ex: <code>permission('perm1', 'perm2')</code>.</p>
<h4 id="args"><a class="header" href="#args">Args</a></h4>
<pre><code class="language-php">#[sender(), text()]
</code></pre>
<p>Ranked's <code>Arg</code>s have many responsibilities.</p>
<ul>
<li>Extracting data from command line arguments</li>
<li>Validation</li>
<li>Converting from string to a useful type (i. e. int)</li>
</ul>
<p>It's required that for every <code>Arg</code> of a HandlerMethod that there is a corresponding parameter of the correct type. That parameter will be given the value extracted by the Arg whenever the command is run.</p>
<h4 id="the-sender-arg"><a class="header" href="#the-sender-arg">The sender() Arg</a></h4>
<p>The <code>sender()</code> Arg requires that it's parameter is of type <code>CommandSender</code> or <code>Player</code>. It doesn't actually take any arguments from the command line, but simply supplies the command sender performing an <code>instanceof</code> check if needed.</p>
<h4 id="the-text-arg"><a class="header" href="#the-text-arg">The text() Arg</a></h4>
<p>The <code>text()</code> Arg requires that it's parameter is of type <code>string</code>, <code>?string</code> or <code>array</code> depending on the arguments passed to it. In this case the type of the parameter must be <code>string</code>. By default <code>text()</code> takes a single string from the command line arguments, and errors if none was given.</p>
<h1 id="asynchronous-commands"><a class="header" href="#asynchronous-commands">Asynchronous Commands</a></h1>
<p>A key aspect of Remark is it's asynchronous approach to UI. This is important because of how complex asynchronous programming will become if not given care. AwaitGenerator is a virion that allows async/await style programming through Generators and their pause/resume functions. It's not required you use AwaitGenerator, but it is recommended and supported by Remark.</p>
<p>Here is the example extended to use Remark's first-class support of AwaitGenerator.</p>
<pre><code class="language-php">#[Cmd('helloworld'), permission('plugin.helloworld.use')]
#[sender(), text()]
public function myFirstCommand(CommandSender $sender, string $text): Generator
{
    $sender-&gt;sendMessage(&quot;§aHello Command Handling! - $text&quot;);
    $response = yield from AsyncApi::fetch($text);
    if ($sender instanceof Player &amp;&amp; !$sender-&gt;isConnected()) {
        return;
    }
    $sender-&gt;sendMessage(&quot;Got Response: $response&quot;);
}
</code></pre>
<p>The return type of the function is now <code>Generator</code>, and <code>yield from</code> is used to call other AwaitGenerator functions. Remember to check that the player is still connected after doing any asynchronous logic.</p>
<p>If you got all of that, let's move on to <a href="forms.html">forms</a>!</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../quick-guide/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../quick-guide/forms.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../quick-guide/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../quick-guide/forms.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
